# Story 1.5: Implement Basic Trim Functionality

## Status
Draft

## Story
**As a** user,
**I want** to define start and end points for clips on the timeline and play the entire timeline sequence,
**so that** I can select portions of videos and preview the complete edited sequence.

## Acceptance Criteria
1. User can interact with the clip representation on the timeline (e.g., dragging handles, entering timecodes) to set an in-point.
2. User can interact with the clip representation on the timeline to set an out-point.
3. The preview player respects the set in/out points during playback (plays only the selected portion).
4. The visual representation on the timeline updates to indicate the trimmed section.
5. The preview player plays the entire timeline sequence (all clips end-to-end) without requiring clip selection.
6. Timeline position determines which clip/segment is currently playing.
7. Playback seamlessly transitions between multiple clips on the timeline.

## Tasks / Subtasks
- [ ] Task 1: Add Trim Handles to Timeline Clips (AC: 1, 2)
  - [ ] Update TimelineClip component with trim handles
  - [ ] Implement drag handles for in/out points
  - [ ] Add visual indicators for trim points
  - [ ] Handle trim handle interactions
- [ ] Task 2: Implement Trim State Management (AC: 1, 2, 4)
  - [ ] Update VideoClip interface with trim points
  - [ ] Add trim state to timeline store
  - [ ] Implement trim point validation
  - [ ] Handle trim updates and persistence
- [ ] Task 3: Implement Trim Handle UI Components (AC: 1, 2)
  - [ ] Create TrimHandle component in apps/renderer/src/components/timeline/
  - [ ] Implement left trim handle (start point)
  - [ ] Implement right trim handle (end point)
  - [ ] Add trim handle visual styling and indicators
  - [ ] Implement trim handle drag functionality
  - [ ] Add trim handle hover states and feedback
  - [ ] Handle trim handle positioning and constraints
- [ ] Task 4: Create Trim Controls UI (AC: 1, 2)
  - [ ] Add trim controls to timeline interface
  - [ ] Implement timecode input fields
  - [ ] Add trim buttons and shortcuts
  - [ ] Create trim preview functionality
- [ ] Task 5: Update Preview Player for Timeline Sequence Playback (AC: 3, 5, 6, 7)
  - [ ] Modify VideoPlayer to support timeline sequence playback
  - [ ] Implement timeline position to clip mapping logic
  - [ ] Handle multi-clip playback with trim points
  - [ ] Add seamless clip transitions
  - [ ] Implement timeline-based seeking across clips
  - [ ] Update preview controls for timeline sequence content
- [ ] Task 6: Implement Timeline Visual Updates (AC: 4)
  - [ ] Update timeline rendering for trimmed clips
  - [ ] Show trim indicators on timeline
  - [ ] Implement trim point visualization
  - [ ] Handle timeline updates when trim changes
- [ ] Task 7: Add Trim Validation and Error Handling (AC: 1, 2)
  - [ ] Validate trim points (start < end, within clip duration)
  - [ ] Handle invalid trim operations
  - [ ] Add user feedback for trim actions
  - [ ] Implement trim reset functionality
- [ ] Task 8: Implement Timeline Sequence Management (AC: 5, 6, 7)
  - [ ] Create timeline sequence data structure
  - [ ] Implement clip ordering and positioning logic
  - [ ] Add timeline duration calculation
  - [ ] Handle empty timeline states
  - [ ] Implement timeline sequence validation

## Dev Notes

### Previous Story Insights
From Story 1.4: Video preview player is implemented with play/pause controls and timeline integration.

### Data Models
**VideoClip Interface** [Source: architecture.md#data-models]:
```typescript
interface VideoClip {
  id: string;
  filePath: string;
  name: string;
  duration: number;
  width: number;
  height: number;
  fps: number;
  trimStart: number;  // Start trim point in seconds
  trimEnd: number;    // End trim point in seconds
  thumbnailPath: string;
}
```

**TimelineClip Interface** [Source: architecture.md#data-models]:
```typescript
interface TimelineClip {
  id: string;
  videoClipId: string;
  trackId: string;
  startTime: number;    // Timeline position in seconds
  endTime: number;      // Timeline end position in seconds
  trimStart: number;    // Trim start point in source clip
  trimEnd: number;      // Trim end point in source clip
  selected: boolean;
}

interface TimelineSequence {
  clips: TimelineClip[];
  totalDuration: number;
  currentPosition: number;
  activeClip: TimelineClip | null;
}
```

### API Specifications
No new API specifications required - uses existing project state management.

### Component Specifications
**TimelineClip Component** [Source: architecture.md#unified-project-structure]:
- Location: apps/renderer/src/components/timeline/TimelineClip.tsx
- Purpose: Individual clip visualization with trim functionality
- Features: Trim handles, drag interactions, trim point visualization
- Props: clip, trackId, onSelect, onTrim, onTrimUpdate

**Timeline Component** [Source: architecture.md#unified-project-structure]:
- Location: apps/renderer/src/components/timeline/Timeline.tsx
- Purpose: Main timeline container with trim support
- Features: Trim controls, timeline rendering, clip management
- Integration: Connected to timelineStore for trim state

**TrimHandle Component** [Source: architecture.md#unified-project-structure]:
- Location: apps/renderer/src/components/timeline/TrimHandle.tsx
- Purpose: Interactive trim handles for start/end points
- Features: Drag functionality, visual feedback, constraint handling
- Props: position, type (start/end), onDrag, constraints

**VideoPlayer Component** [Source: architecture.md#unified-project-structure]:
- Location: apps/renderer/src/components/preview/VideoPlayer.tsx
- Purpose: Video preview with timeline sequence and trim support
- Features: Timeline sequence playback, trimmed playback, clip transitions, timeline-based seeking
- Props: timelineSequence, currentPosition, onPlay, onPause, onSeek

### File Locations
**Component Files** [Source: architecture.md#unified-project-structure]:
- apps/renderer/src/components/timeline/TimelineClip.tsx (updated)
- apps/renderer/src/components/timeline/Timeline.tsx (updated)
- apps/renderer/src/components/preview/VideoPlayer.tsx (updated)

**Store Files**:
- apps/renderer/src/stores/timelineStore.ts (updated)
- apps/renderer/src/stores/projectStore.ts (updated)
- apps/renderer/src/stores/sequenceStore.ts (new)

**Type Definitions**:
- packages/shared/src/types/video.ts (updated)
- packages/shared/src/types/timeline.ts (updated)
- packages/shared/src/types/sequence.ts (new)

### Testing Requirements
**Testing Standards** [Source: architecture.md#tech-stack]:
- Manual testing for MVP
- Test file location: apps/renderer/tests/
- Test cases: Trim functionality, timeline interactions, preview updates
- Performance: Responsive trim interactions, smooth timeline updates

### Technical Constraints
**Timeline Interactions** [Source: architecture.md#architectural-patterns]:
- Use Canvas-based timeline for performance
- Implement efficient trim handle rendering
- Handle drag interactions smoothly

**State Management** [Source: architecture.md#tech-stack]:
- Use Zustand for trim state management
- Maintain trim points in VideoClip and TimelineClip
- Update timeline and preview when trim changes

**Preview Integration** [Source: architecture.md#tech-stack]:
- Respect trim points in video playback
- Handle trim point seeking
- Update preview controls for trimmed content

## Testing

### Testing Standards
- **Test Approach**: Manual testing for MVP
- **Test Location**: apps/renderer/tests/
- **Test Framework**: Manual verification only
- **Key Test Cases**:
  - Trim handles are visible and draggable
  - In/out points can be set via drag handles
  - Timecode input fields work correctly
  - Preview player respects trim points
  - Timeline visual updates show trimmed section
  - Trim validation prevents invalid operations
  - Trim reset functionality works
  - Trim handle drag functionality works smoothly
  - Trim handle visual feedback is displayed
  - Trim handle positioning and constraints work correctly
  - Timeline sequence plays all clips end-to-end without selection
  - Timeline position correctly determines active clip
  - Seamless transitions between multiple clips
  - Timeline-based seeking works across multiple clips
  - Empty timeline states are handled gracefully

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-27 | 1.0 | Initial story creation | Scrum Master Bob |
| 2025-01-27 | 1.1 | Added detailed trim handle implementation tasks and testing | Scrum Master Bob |
| 2025-01-27 | 1.2 | Enhanced story to include timeline sequence playback functionality | Dev Agent |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here*
